---
title: "Tutorial para la elaboraci√≥n del informe final del m√≥dulo en un notebook de Quarto"
author: "David Mart√≠n-G√°lvez"
date: today
format:
  html: 
    theme: default
    toc: true
    number-sections: true
    embed-resources: true
editor: source
execute: 
  eval: false
  echo: true
---

## An√°lisis de los datos de RNAseq de los gorriones de la Facultad de Ciencias de la UGR

Pasos generales a seguir:

1.  Revisar el contexto (objetivos, metodolog√≠a, datos, secuencias, ubicaciones...)
2.  An√°lisis bioinform√°tico de las secuencias en picasso.
    1.  Copiar todas las secuencias a picasso.
    2.  Revisar los an√°lisis y resultados de los an√°lisis realizados con los pilotos.
    3.  Hacer el an√°lisis para todas las muestras seleccionadas.


## 1.  Revisar el contexto (objetivos, metodolog√≠a, datos, secuencias, ubicaciones...)

## 2.  An√°lisis bioinform√°tico de las secuencias en picasso.

### 2.1.  Copiar todas las secuencias a picasso.

##### 2.1.1 Creaci√≥n del usuario nasssh y configuraci√≥n desde picasso
Las secuencias est√°n guardadas en la nas, dentro de la carpeta 1_SEQUENCING_RAW.
He creado un usuario `nasssh`perteneciente al group `ssh_no_admin` para que pueda acceder a la nass desde cualquier servidor a traves de `ssh` pero con permisos limitados. Solo puede acceder a su `home`y a la carpeta `/volumen1/ 1_SEQUENCING_RAW/`. Para poder modificar los permisos de la `home`lo que he hecho es dar permisos 700 a todas las carpetas de `/volumen1/homes` 

As√≠ de esta manera me puedo conectar de forma segura desde picasso y no podre ver nada de las homes de los otros usuarios, por chmod 700, y solo me podr√© conectar a `/volumen1/ 1_SEQUENCING_RAW/`, por como he configurado los permisos ACL del usuario `nasssh`.

### 2.1.2. Creaci√≥n de las carpetas del proyecto en Picasso y en Serendipia

Voy a probar esta opci√≥n que me recomienda chatGPT, en vez de montar picasso con sshfs.

**VS Code Remote‚ÄìSSH (La recomendada para HPC)**

Con esto voy a poder:
‚úî editar archivos directamente en el cluster
‚úî abrir terminales remotos en Picasso desde VS Code
‚úî navegar carpetas del HPC sin montar nada
‚úî cero problemas con SSHFS
‚úî super estable para pipelines bioinform√°ticos

**Configuraci√≥n**

1Ô∏è‚É£ Instalar la extensi√≥n en VS Code
	‚Ä¢	Remote - SSH
	‚Ä¢	Remote - SSH: Editing Configuration Files (opcional)

2Ô∏è‚É£ Modifico la entrada SSH para Picasso en `.ssh/config`
# -------- Picasso UGR / SCBI --------
``` {bash}
Host picasso
    HostName picasso.scbi.uma.es
    User dmartin
    IdentityFile ~/.ssh/id_ed25519_picasso
    IdentitiesOnly yes
    # Mantener viva la conexi√≥n (evita desconexiones en VS Code)
    ServerAliveInterval 60
    ServerAliveCountMax 5
    # Evita el error "Too many authentication methods"
    PreferredAuthentications publickey
    # Para Remote-SSH de VS Code (muy importante)
    ForwardAgent yes
```



3Ô∏è‚É£ Probar conexi√≥n SSH desde tu Mac

En el terminal:

ssh picasso

Si entra sin contrase√±a: perfecto.
Si pide contrase√±a, revisamos las claves (yo te ayudo).

‚∏ª

4Ô∏è‚É£ Conectar VS Code al cluster

En VS Code:
	1.	Pulsa F1
	2.	Escribe: Remote-SSH: Connect to Host‚Ä¶
	3.	Elige picasso
	4.	VS Code abrir√° una ventana nueva:
‚ÄúInstalling VS Code Server on host‚Ä¶‚Äù

Despu√©s ver√°s tu √°rbol de carpetas del cluster en el panel izquierdo.
Igual que si fuera una carpeta local.

‚∏ª

5Ô∏è‚É£ Abrir carpeta del proyecto en el cluster

Una vez conectado:
	1.	En la barra izquierda, pulsa Open Folder
	2.	Selecciona (por ejemplo):

/home/TU_USUARIO/proyectos/rna-seq-gorriones

(si no existe, la creas)

Ahora est√°s editando DIRECTAMENTE en Picasso sin SSHFS.

‚∏ª

6Ô∏è‚É£ Terminal remota del cluster dentro de VS Code

Pulsa:

Ctrl + `

O:

Terminal > New Terminal

Y VS Code abrir√° una terminal en Picasso, no en tu Mac.

üëâ Aqu√≠ puedes ejecutar:

sbatch slurm/fastqc.sbatch

o cualquier cosa del cluster.

‚∏ª

7Ô∏è‚É£ Extensiones √∫tiles (instaladas en el servidor remoto)

Cuando VS Code te diga:

‚ÄúThe extension is recommended to install on the remote host‚Äù

Di que s√≠ y se instalar√°n en Picasso:
	‚Ä¢	Python
	‚Ä¢	Bash syntax
	‚Ä¢	YAML
	‚Ä¢	GitLens
	‚Ä¢	Quarto (opcional si procesas docs en el cluster)

‚∏ª

8Ô∏è‚É£ Flujo recomendado (muy profesional)

üü¢ En tu Mac:
	‚Ä¢	Quarto
	‚Ä¢	Documentaci√≥n del proyecto
	‚Ä¢	Repositorio git
	‚Ä¢	Previsualizas resultados

üü¢ En el cluster:
	‚Ä¢	Scripts
	‚Ä¢	Entornos con conda/module
	‚Ä¢	FastQC, STAR, salmon, etc.
	‚Ä¢	Slurm jobs

üü¢ Sincronizaci√≥n:

Usa git:

En Picasso:

git pull

En tu Mac:

git push

Mucho m√°s profesional que editar todo directamente en el HPC.

‚∏ª

‚úîÔ∏è BENEFICIOS de Remote-SSH VS SSHFS

Remote-SSH	SSHFS
Estable	Inestable
No necesita montar nada	Montaje propenso a fallos
Siempre r√°pido	Lento con miles de archivos
No interfiere con NFS/HPC	Puede bloquear filesystem del cluster
Extensiones funcionan	Muchas fallan
Manejo ideal de permisos	Permisos pueden corromperse
El est√°ndar en HPC profesionales	Nombrado como mala pr√°ctica


‚∏ª

üéâ Ya lo tienes listo

Si quieres, te configuro ahora mismo:
	‚Ä¢	el archivo ~/.ssh/config
	‚Ä¢	la estructura de carpetas del proyecto en Picasso
	‚Ä¢	un script Slurm template optimizado para UGR
	‚Ä¢	c√≥mo sincronizar autom√°ticamente con git
	‚Ä¢	c√≥mo integrar Quarto + HPC

¬øTe preparo el .ssh/config exacto para Picasso?



---



## Introducci√≥n al uso de documentos Quarto

Este documento sirve como **tutorial** para la elaboraci√≥n del informe final mediante la creaci√≥n de un **Notebook** con **Quarto**. En particular, aprender√°s a crear, estructurar y presentar correctamente el informe final del m√≥dulo, combinando texto explicativo, c√≥digo y resultados. Incluye ejemplos de c√≥mo escribir texto en Markdown y c√≥mo estructurar, comentar y ejecutar c√≥digo en `R` dentro de un mismo documento.

Quarto permite combinar texto explicativo, c√≥digo y resultados en un √∫nico archivo. Para crear y renderizar documentos `.qmd`, necesitas tener instalado el programa **Quarto** en tu sistema.

> Adem√°s de este tutorial, en el campus virtual encontrar√°s el archivo `Plantilla_informe_final.qmd`, que podr√°s usar como base para elaborar tu propio informe.

------------------------------------------------------------------------

## Instalaci√≥n de Quarto

Antes de comenzar, aseg√∫rate de tener instalado **Quarto**.

1.  Descarga el programa desde la p√°gina oficial:\
    <https://quarto.org/download/>
2.  Inst√°lalo siguiendo las instrucciones para tu sistema operativo (Windows, macOS o Linux).
3.  [Opcional, uso avanzado.]{style="color: red; font-weight: bold; background-color: yellow"} Puedes comprobar que funciona correctamente desde la **Terminal** o desde la pesta√±a `Terminal` de `RStudio` con el comando:

``` bash
quarto check
```

> **Nota:** La consola de RStudio (`Console`) no reconoce comandos de la terminal.\
> Usa la pesta√±a *Terminal* o ejecuta el comando fuera de RStudio.

4.  Instala tambi√©n el paquete de R `quarto`, que permite renderizar documentos desde la consola de R:

``` r
install.packages("quarto")
```

5.  Verifica la instalaci√≥n con:

``` r
quarto::quarto_version()
```

------------------------------------------------------------------------

## Estructura b√°sica de un documento Quarto

Todo documento `.qmd` comienza con un bloque **YAML**, delimitado por tres guiones (`---`). Act√∫a como la portada t√©cnica del documento, donde defines los metadatos principales del informe: t√≠tulo, autor, fecha, formato, tema, etc.

Ejemplo de encabezado YAML sencillo:

``` markdown
---
title: "Informe Final: An√°lisis de IgY en abubillas"
author: "Nombre Apellido"
format: html
---
```

Despu√©s del encabezado, comienza el cuerpo del documento, escrito en **Markdown**, un lenguaje sencillo que permite combinar texto, listas, ecuaciones, tablas y c√≥digo.

------------------------------------------------------------------------

## Ejemplos b√°sicos de escritura en Markdown

### Encabezados

Usa almohadillas (`#`) para crear t√≠tulos y subt√≠tulos jer√°rquicos:

``` markdown
# T√≠tulo principal (nivel 1)
## Subt√≠tulo (nivel 2)
### Subt√≠tulo menor (nivel 3)
#### Subt√≠tulo de nivel 4
```

### √ânfasis y formato de texto

-   **Negrita**: `**texto**`\
-   *Cursiva*: `*texto*`\
-   ~~Tachado~~: `~~texto~~`\
-   Ecuaciones: `$E = mc^2$` $E = mc^2$
-   `C√≥digo`: `` `texto` ``\
-   Bloque de c√≥digo: ```` ```texto``` ````

### Listas

**Lista con vi√±etas:**

*Markdown:*

``` markdown
- Elemento 1
- Elemento 2
  - Sub-elemento 2.1
  - Sub-elemento 2.2
- Elemento 3
```

*Resultado:*

-   Elemento 1
-   Elemento 2
    -   Sub-elemento 2.1
    -   Sub-elemento 2.2
-   Elemento 3

**Lista numerada:**

*Markdown:*

``` markdown
1. Primer paso
2. Segundo paso
   1. Sub-paso 2.1
   2. Sub-paso 2.2
3. Tercer paso
```

*Resultado:*

1.  Primer paso
2.  Segundo paso
    1.  Sub-paso 2.1
    2.  Sub-paso 2.2
3.  Tercer paso

### Enlaces e im√°genes

*Markdown:*

``` markdown
[P√°gina web de Quarto](https://quarto.org)

![Logo de Quarto](images/logo_quarto.png)
```

*Resultado:*

[P√°gina web de Quarto](https://quarto.org)

![Logo de Quarto](images/logo_quarto.png)

### Tablas

*Markdown:*

``` markdown
| Variable | Descripci√≥n              | Tipo       |
|-----------|--------------------------|------------|
| igY       | Inmunoglobulina Y        | Num√©rica   |
| behav     | Comportamiento migratorio | Categ√≥rica |
```

*Resultado:*

| Variable | Descripci√≥n               | Tipo       |
|----------|---------------------------|------------|
| igY      | Inmunoglobulina Y         | Num√©rica   |
| behav    | Comportamiento migratorio | Categ√≥rica |

### HTML embebido. [Uso avanzado.]{style="color: red; font-weight: bold; background-color: yellow"}

Markdown y HTML pueden combinarse libremente en un mismo documento Quarto, lo que ofrece un control visual muy flexible. Por ejemplo, puedes usar etiquetas **HTML** dentro del texto para personalizar el formato, el color o el estilo de presentaci√≥n:

*Markdown:*

``` html
<p style="color: darkgreen; font-weight: bold;">Texto en verde y negrita.</p>

<div style="background-color: #f0f0f0; padding: 10px; border-radius: 5px;">
Este texto aparece dentro de un cuadro sombreado.
</div>
```

*Resultado:*

<p style="color: darkgreen; font-weight: bold;">

Texto en verde y negrita.

</p>

::: {style="background-color: #f0f0f0; padding: 10px; border-radius: 5px;"}
Este texto aparece dentro de un cuadro sombreado.
:::

## C√≥mo incluir c√≥digo ejecutable en Quarto

En Quarto (y R Markdown) el c√≥digo ejecutable se inserta en **bloques o ‚Äúchunks‚Äù**. Cada chunk se abre con tres tildes invertidas seguidas del identificador del lenguaje (por ejemplo, ```` ```{r} ````), y se cierra con tres tildes m√°s en una nueva l√≠nea (```` ``` ````). Quarto, adem√°s de `R`, reconoce otros muchos lenguajes de programaci√≥n.

### Opciones para la ejecuci√≥n de los *chunks* de c√≥digo. [Uso avanzado.]{style="color: red; font-weight: bold; background-color: yellow"}

Los **chunks** en Quarto permiten el uso opciones que controlan c√≥mo se ejecutan y muestra el c√≥digo. Esas opciones se pueden a√±adir tras una coma dentro de las llaves de los corchetes de la primera l√≠nea `{r, opci√≥n1=valor1, opci√≥n2=valor2}`, o bien, poniendo cada una de las opci√≥nes en una l√≠nea separada despues de la primer del chunk siguiendo este formato `#| opci√≥n: valor`.

A continuaci√≥n se listan algunas de las m√°s comunes:

| Opci√≥n | Descripci√≥n | Ejemplo dentro de corchete | Ejemplo en l√≠nea aparte |
|-----------------|---------------------|-----------------|-----------------|
| `echo` | Muestra (`TRUE`) o oculta (`FALSE`) el c√≥digo. | `{r, echo=FALSE}` | `#| echo: false` |
| `eval` | Ejecuta (`TRUE`) o no ejecuta (`FALSE`) el c√≥digo. | `{r, eval=FALSE}` | `#| eval: false` |
| `include` | Incluye el bloque en el documento final (`TRUE`/`FALSE`). | `{r, include=FALSE}` | `#| include: false` |
| `results` | Controla c√≥mo se muestran los resultados (`show`, `hide`, `asis`). | `{r, results='hide'}` | `#| results: hide` |
| `label` | Para dar nombre el chunk | `{r nombre}` o `{r, label="nombre"}` | `#| label: nombre` |

Otras menos comunes:

| Opci√≥n | Descripci√≥n | Ejemplo dentro de corchete | Ejemplo en l√≠nea aparte |
|-----------------|---------------------|-----------------|-----------------|
| `fig.width`, `fig.height` | Controlan el tama√±o de las figuras. | `{r, fig.width=6, fig.height=4}` | `#| fig.width: 6` `#| fig.height: 4` |
| `fig.cap` | A√±ade un pie de figura. | `{r, fig.cap="Figura 1: Boxplot de IgY"}` | `#| fig.cap: "Figura 1: Boxplot de IgY"` |
| `fig.align` | Alinea la figura (`default`, `left`, `center`, `right`). | `{r, fig.align='center'}` | `#| fig.align: center` |
| `message` | Muestra los mensajes generados (por ejemplo al cargar librer√≠as). | `{r, message=FALSE}` | `#| message: false` |
| `warning` | Muestra o suprime las advertencias. | `{r, warning=FALSE}` | `#| warning: false` |

### Opciones por defecto para la ejecuci√≥n de los chunks. [Uso avanzado.]{style="color: red; font-weight: bold; background-color: yellow"}

Puedes establecer las opciones de ejecuci√≥n por defecto para todos los chunks de tu documento en el encabezado *YMAL* del documento, dentro del grupo `execute`, de esta manera:

``` markdown
---
title: "Informe Final: An√°lisis de IgY en abubillas"
author: "Nombre Apellido"
format: html
execute:
  echo: true
  eval: true
---
```

O bien, puedes establecer opciones por defecto para todos los **chunks** en la parte inicial del documento, incluyendo en un **chunk** en `R` el comando

``` r
knitr::opts_chunk$set(opcion1 = valor1, opcion2 = valor2, ...)
```

Por ejemplo:

``` r
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

> **Nota:** Cualquier opci√≥n por defecto para todo el documento puede ser invalidada para un determinado **chunk** al establecerse un nuevo valor para esa opci√≥n dentro de ese **chunk**.

------------------------------------------------------------------------

## Renderizaci√≥n de un documento Quarto

**Renderizar** significa *compilar* o *transformar* tu documento `.qmd` en un formato final legible (por ejemplo **HTML**, **PDF** o **Word**). Este proceso ejecuta todo el c√≥digo del documento y combina los resultados con el texto y el formato para generar el informe final.

Durante este proceso, Quarto ejecuta los *chunks* de c√≥digo, inserta en el texto aquello que hayas configurado como salida en los chunks (c√≥digo, resultados, o ambos) y genera un archivo final con el formato indicado en el encabezado YAML.

### Opciones de formato de salida

Puedes renderizar tu documento en diferentes formatos modificando el bloque `format` de tu **YAML**. Por ejemplo:

-   **HTML** (.html) (**recomendado**):

    ``` yaml
    format: html
    ```

-   **PDF** (.pdf) (*ver m√°s adelante para los requerimientos*):

    ``` yaml
    format: pdf
    ```

-   **Word (.docx)**:

    ``` yaml
    format: docx
    ```

El archivo renderizado (HTML, PDF o DOCX) se crear√° en la misma carpeta donde se encuentra el archivo `.qmd`

[Uso avanzado.]{style="color: red; font-weight: bold; background-color: yellow"} Si deseas que tu documento pueda renderizarse en distintos formatos (HTML, PDF y Word), puedes a√±adir m√°s de una opci√≥n en el **YAML**, dentro del bloque `format`, de esta manera:

``` yaml
format:
  html: default
  pdf: default
  docx: default
```

### Formas de renderizar tu informe:

Tienes tres formas de renderizar tu informe

1.  **Desde RStudio (recomendado):**
    -   Abre tu archivo `.qmd`.
    -   Pulsa el bot√≥n **Render** (indicado tambi√©n con una flecha azul).
    -   El formato de salida se define en el encabezado YAML (por ejemplo `format: html`).
    -   En el desplegable de la rueda de engranaje al lado del bot√≥n **Render**, puedes configurar si la salida de la renderizaci√≥n se muestra en la pesta√±a `Viewer` del panel `Output` de `RStudio` (por defecto), o en tu explorador web (`Preview in Window`).

> [Uso avanzado.]{style="color: red; font-weight: bold; background-color: yellow"} Si incluyes varios formatos en el YAML (HTML, PDF, DOCX), podr√°s elegir entre ellos usando las opciones en el desplegable de la rueda de engranaje al lado del bot√≥n **Render**.

2.  [Uso avanzado.]{style="color: red; font-weight: bold; background-color: yellow"} **Desde la consola de R (si tienes el paquete `quarto` instalado):**

    ``` r
    quarto::quarto_render("Informe_IgY_ApellidoNombre.qmd")
    ```

    o especificando el formato:

    ``` r
    quarto::quarto_render("Informe_IgY_ApellidoNombre.qmd", output_format = "pdf")
    ```

3.  [Uso avanzado.]{style="color: red; font-weight: bold; background-color: yellow"} **Desde la terminal del sistema o el panel ‚ÄúTerminal‚Äù de RStudio:**

    ``` bash
    quarto render Informe_IgY_ApellidoNombre.qmd
    ```

    > **Nota:** La consola de RStudio no reconoce comandos de la terminal. Los comandos `quarto render` deben ejecutarse en la pesta√±a `Terminal`, si la tienes activada, o fuera de RStudio.

------------------------------------------------------------------------

### Generar documentos PDF. [Uso avanzado.]{style="color: red; font-weight: bold; background-color: yellow"}

Para poder renderizar documentos en formato **PDF**, es necesario tener instalado un motor $LaTeX$. La opci√≥n m√°s sencilla es instalar **TinyTeX**, una version ligera de $LaTeX$ que puede instalarse directamente desde R.

Ejecuta estos comandos en la consola de R:

``` r
install.packages("tinytex")
tinytex::install_tinytex()
```

Esto instalar√° tanto el paquete `tinytex` dentro de R como el motor $LaTeX$ completo en tu sistema (en una carpeta interna gestionada por R). Una vez instalado, Quarto y RStudio lo detectar√°n autom√°ticamente cuando intentes renderizar un archivo `.qmd` a PDF.

Puedes verificar que todo est√° correctamente instalado con:

``` r
tinytex::is_tinytex()
```

No es necesario realizar configuraciones adicionales: al pulsar **Render** con el formato `pdf` en el encabezado YAML, Quarto utilizar√° autom√°ticamente TinyTeX para generar el archivo final.

## Consejos finales

-   Usa t√≠tulos y subt√≠tulos (`##`, `###`) para estructurar el informe.
-   Aseg√∫rate de que todos los gr√°ficos se generan correctamente al renderizar.
-   Guarda tu informe con el nombre: `Informe_IgY_ApellidoNombre.qmd`.
-   Renderiza y revisa el archivo generado antes de la entrega. La forma m√°s sencilla es renderizar tu informe a `.html`.
-   Entrega tanto el archivo `.qmd` como el archivo renderizado en el formato deseado (ejemplo, `.html`, `.pdf` o `.docx`).

## M√°s informaci√≥n

Este tutorial se basa en la documentaci√≥n disponible en la p√°gina oficial de Quarto (<https://quarto.org>), donde tambi√©n puedes encontrar recursos adicionales sobre la creaci√≥n de notebooks y otros tipos de documentos reproducibles.

------------------------------------------------------------------------